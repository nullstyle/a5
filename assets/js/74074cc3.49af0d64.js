"use strict";(self.webpackChunkproject_website=self.webpackChunkproject_website||[]).push([[9276],{1383:(t,n,e)=>{e.d(n,{$p:()=>c,Rb:()=>h,WP:()=>w,lN:()=>p,o4:()=>f,q8:()=>l,r5:()=>m,uB:()=>d});var o=e(7823),r=e(842),s=e(9699),i=e(1997);function a(t){return t*(Math.PI/180)}function u(t){return t*(180/Math.PI)}function l(t){return[r.Bw(t),Math.atan2(t[1],t[0])]}function c(t){let[n,e]=t;return[n*Math.cos(e),n*Math.sin(e)]}function f(t){return r.ZF(r.vt(),t,i.wc)}function p(t){const n=Math.atan2(t[1],t[0]),e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return[n,Math.acos(t[2]/e)]}function d(t){let[n,e]=t;return[Math.sin(e)*Math.cos(n),Math.sin(e)*Math.sin(n),Math.cos(e)]}o.fG(Float64Array);const g=93;function h(t){let[n,e]=t;return[a(n+g),a(90-e)]}function w(t){let[n,e]=t;return[u(n)-g,90-u(e)]}function m(t){const n=d(t),e=s.vt();return s.Yc(e,[0,0,1],n),e}},1921:(t,n,e)=>{e.d(n,{u$:()=>k,WH:()=>B,ce:()=>S});var o=e(7823),r=e(3522),s=e(842),i=e(1383),a=e(3243),u=e(6864),l=e(1970),c=e(1997),f=e(1148),p=e(3255);o.fG(Float64Array);const d=!1,g=s.o8(c.w),h=s.ze(s.vt(),c.w),w=[0,1,2,3,4].map((t=>{const n=r.vt();return r.$0(n,f.UT*t),n})),m=s.vt();o.fG(Float64Array);const v=r.vt();function x(t,n){const e=(0,i.q8)(t),o=(0,u.s)(e,n.quat,n.angle),l=(0,a.jS)(o,n)?n:(0,a.Sj)(o);if(l.id!==n.id){const e=s.vt();r.$0(v,n.angle),s.ZF(e,t,v);const{point:c,quat:p}=(0,a.MQ)(e,n,l);let d=0;n.angle!==l.angle&&0!==l.angle&&(d=-f.R);let g=(0,i.q8)(c);g[1]=g[1]-d;const h=(0,u.s)(g,p,d);o[0]=h[0],o[1]=h[1]}return(0,i.WP)(o)}function M(t,n){const e=t.getVertices().map((t=>x(t,n)));return l.c.normalizeLongitudes(e)}var b=e(2189);o.fG(Float64Array);const y=r.vt();function S(t,n){const e=1+n-b.To,o=[t],r=50/Math.pow(2,e);for(let l=0;l<25;l++){const n=l/25*r,e=s.fA(Math.cos(l)*n,Math.sin(l)*n);s.WQ(e,e,t),o.push(e)}const i=[];for(const s of o){const e=j(s,n);if(n<b.To||I(e,t))return(0,b.lK)(e);i.push(e)}let a=1/0,u=null;for(const l of i){const n=x(P(l).getCenter(),l.origin),e=s.xg(n,t);e<a&&(a=e,u=l)}if(u)return(0,b.lK)(u);throw new Error("No cell found")}function j(t,n){const e=(0,i.Rb)(t),o={...(0,a.Sj)(e)};r.$0(y,-o.angle);const l=(0,u.r)(e,o.quat,o.angle),d=(0,i.$p)(l),g=function(t){const n=(Math.atan2(t[1],t[0])-c.V+f.JM)%f.JM;return Math.ceil(n/f.UT)%5}(d),{segment:h,orientation:w}=(0,a.b5)(g,o);if(n<b.To)return{S:0n,segment:h,origin:o,resolution:n};if(0!==g){const t=2*f.R*g;r.$0(y,-t),s.ZF(d,d,y)}const m=1+n-b.To;s.hs(d,d,2**m);const v=(0,i.o4)(d);return{S:(0,p.eS)(v,m,w),segment:h,origin:o,resolution:n}}function P(t){let{S:n,segment:e,origin:o,resolution:r}=t;const{quintant:i,orientation:u}=(0,a.BL)(e,o);if(r===b.To-1){const t=function(t){const n=c.LF.clone();return n.transform(w[t]),n}(i);return t}if(r===b.To-2)return function(){const t=[];for(const n of w)t.push(s.ZF(s.vt(),c.v,n));return new l.c(t)}();const f=r-b.To+1;return function(t,n,e){const o=(d?c.LF:c.tK).clone();s.ZF(m,e.offset,c.P9),e.flips[0]===p.NO&&e.flips[1]===p._Y&&o.rotate180();const{k:r}=e,i=e.flips[0]+e.flips[1];return((-2===i||2===i)&&r>1||0===i&&(0===r||3===r))&&o.reflectY(),e.flips[0]===p._Y&&e.flips[1]===p._Y?o.rotate180():e.flips[0]===p._Y?o.translate(h):e.flips[1]===p._Y&&o.translate(g),o.translate(m),o.scale(1/2**t),o.transform(w[n]),o}(f,i,(0,p.ky)(n,f,u))}function B(t){const{S:n,segment:e,origin:o,resolution:r}=(0,b.iu)(t),s=x(P({S:n,segment:e,origin:o,resolution:r}).getCenter(),o);return l.c.normalizeLongitudes([s])[0]}function k(t){const{S:n,segment:e,origin:o,resolution:r}=(0,b.iu)(t);return M(P({S:n,segment:e,origin:o,resolution:r}),o)}function I(t,n){const e=M(P(t),t.origin);return new l.c(e).containsPoint(n)}},2189:(t,n,e)=>{e.d(n,{To:()=>r,iu:()=>u,lK:()=>l,s7:()=>f,xZ:()=>c});var o=e(3243);const r=3,s=31,i=58n,a=0x3ffffffffffffffn;function u(t){const n=function(t){let n=s-1,e=t>>1n;for(;n>0&&0n===(0b1n&e);)n-=1,e>>=n<r?1n:2n;return n}(t);if(0===n)return{origin:o.kt[0],segment:0,S:0n,resolution:n};const e=Number(t>>58n);let u,l;if(1===n){const t=e;u=o.kt[t],l=0}else{const t=Math.floor(e/5);u=o.kt[t],l=(e+u.firstQuintant)%5}if(!u)throw new Error(`Could not parse origin: ${e}`);if(n<r)return{origin:u,segment:l,S:0n,resolution:n};const c=BigInt(2*(n-r+1));return{origin:u,segment:l,S:(t&a)>>i-c,resolution:n}}function l(t){const{origin:n,segment:e,S:o,resolution:a}=t;if(a>s)throw new Error(`Resolution (${a}) is too large`);if(0===a)return 0n;let u;if(a<r)u=BigInt(a);else{u=BigInt(2*(1+a-r)+1)}const l=(e-n.firstQuintant+5)%5;let c;if(c=1===a?BigInt(n.id)<<58n:BigInt(5*n.id+l)<<58n,a>=r){const t=BigInt(2*(a-r+1));if(BigInt(o)>=1n<<t)throw new Error(`S (${o}) is too large for resolution level ${a}`);c+=BigInt(o)<<i-t}return c|=1n<<i-u,c}function c(t,n){const{origin:e,segment:i,S:a,resolution:c}=u(t),f=n??c+1;if(f<=c)throw new Error(`Target resolution (${f}) must be greater than current resolution (${c})`);if(f>s)throw new Error(`Target resolution (${f}) exceeds maximum resolution (${s})`);let p=[e],d=[i];0===c&&(p=o.kt),(0===c&&f>1||1===c)&&(d=[0,1,2,3,4]);const g=f-Math.max(c,r-1),h=Math.pow(4,g),w=[],m=a<<BigInt(2*g);for(const o of p)for(const t of d)for(let n=0;n<h;n++){const e=m+BigInt(n);w.push(l({origin:o,segment:t,S:e,resolution:f}))}return w}function f(t,n){const{origin:e,segment:o,S:r,resolution:s}=u(t),i=n??s-1;if(i<0)throw new Error(`Target resolution (${i}) cannot be negative`);if(i>=s)throw new Error(`Target resolution (${i}) must be less than current resolution (${s})`);return l({origin:e,segment:o,S:r>>BigInt(2*(s-i)),resolution:i})}},3243:(t,n,e)=>{e.d(n,{BL:()=>b,MQ:()=>y,Sj:()=>S,b5:()=>M,jS:()=>j,kt:()=>m});var o=e(7823),r=e(9699),s=e(329),i=e(842),a=e(1383),u=e(1148);o.fG(Float64Array);const l=[0,0,1],c=["vu","uw","vw","vw","vw"],f=["wu","uw","vw","vu","uw"],p=["wu","uv","wv","wu","uw"],d=["vu","uv","wv","wu","uw"],g=[c,d,p,f,p,d,p,f,f,f,d,d],h=[4,2,3,2,0,4,3,2,2,0,3,0],w=[0,1,2,4,3,5,7,8,6,11,10,9],m=[];let v=0;function x(t,n){const e={id:v,axis:t,quat:(0,a.r5)(t),angle:n,orientation:g[v],firstQuintant:h[v]};m.push(e),v++}function M(t,n){const e=n.orientation,o=((e===c||e===f?-1:1)*((t-n.firstQuintant+5)%5)+5)%5,r=e[o];return{segment:(n.firstQuintant+o)%5,orientation:r}}function b(t,n){const e=n.orientation,o=e===c||e===f?-1:1,r=(t-n.firstQuintant+5)%5,s=e[r];return{quintant:(n.firstQuintant+o*r+5)%5,orientation:s}}function y(t,n,e){const o=r.vt();r.B8(o,n.quat);const c=(0,a.uB)(e.axis),f=s.vt();s.gL(f,c,o);const p=i.vt();i.S8(p,[f[0],f[1]]),i.hs(p,p,2*u.mN);const d=i.vt();i.Re(d,t,p);const g=r.vt();return r.Yc(g,l,f),r.lw(g,n.quat,g),{point:d,quat:g}}function S(t){let n=1/0,e=m[0];for(const o of m){const r=P(t,o.axis);r<n&&(n=r,e=o)}return e}function j(t,n){return P(t,n.axis)>.49}function P(t,n){const[e,o]=t,[r,s]=n,i=r-e,a=s-o,u=Math.sin(a/2),l=Math.sin(i/2);return u*u+l*l*Math.sin(o)*Math.sin(s)}!function(){x([0,0],0);for(let t=0;t<5;t++){const n=t*u.UT,e=n+u.R;x([n,u.Kk],u.R),x([e,Math.PI-u.Kk],u.R)}x([0,Math.PI],0)}(),m.sort(((t,n)=>w.indexOf(t.id)-w.indexOf(n.id))),m.forEach(((t,n)=>t.id=n))},3255:(t,n,e)=>{e.d(n,{NO:()=>i,_Y:()=>s,eS:()=>x,ky:()=>w});var o=e(7823),r=e(842);o.fG(Float64Array);const s=-1,i=1,a=t=>{let[n,e]=t;return r.fA(n-e,e)},u=r.fA(1,0),l=r.fA(0,1),c=r.ze(r.vt(),u),f=r.ze(r.vt(),l),p=r.fA(0,0),d=(t,n)=>{let[e,o]=n,a=p,d=p;switch(e===i&&o===i?(a=u,d=l):e===s&&o===i?(a=f,d=c):e===i&&o===s?(a=l,d=u):e===s&&o===s&&(a=c,d=f),t){case 0:return p;case 1:return a;case 2:return r.WQ(r.vt(),d,a);case 3:return r.Ln(r.vt(),d,a,2);default:throw new Error(`Invalid Quaternary value: ${t}`)}},g=t=>[[i,i],[i,s],[i,i],[s,i]][t],h=r.fA(-1,1),w=(t,n,e)=>{let o=BigInt(t);const i="wv"===e||"vw"===e,a="wu"===e||"uw"===e;("vu"===e||"wu"===e||"vw"===e)&&(o=(1n<<BigInt(2*n))-o-1n);const u=m(o);if(a){const{offset:[t,n],flips:[e,o]}=u;u.offset=[n,t],e===s&&r.WQ(u.offset,u.offset,h),o===s&&r.Re(u.offset,u.offset,h)}if(i){const{offset:[t,e],flips:o}=u,r=(1<<n)-(t+e);o[0]=-o[0],u.offset[1]=r,u.flips=o}return u},m=t=>{const n=Number(t)%4,e=r.vt(),o=[i,i];let s=BigInt(t);const u=[];for(;s>0n;)u.push(Number(s%4n)),s>>=2n;for(let i=u.length-1;i>=0;i--){r.hs(e,e,2);const t=d(u[i],o);r.WQ(e,e,t),r.lw(o,o,g(u[i]))}return{flips:o,k:n,offset:a(e)}},v=(t,n)=>{let[e,o]=t,r=0,i=n[0]===s?-(e+o):e+o,a=n[1]===s?-e:e,u=n[0]===s?-o:o;return r=n[0]+n[1]===0?u<1?0:a>1?3:i>1?2:1:i<1?0:a>1?3:u>1?2:1,r},x=function(t,n,e){void 0===e&&(e="uv");const o="vu"===e||"wu"===e||"vw"===e,r="wv"===e||"vw"===e,s="wu"===e||"uw"===e;let i=[...t];if(s&&(i[0]=t[1],i[1]=t[0]),r){const[t,e]=i;i[1]=(1<<n)-(t+e)}let a=M(i);return o&&(a=(1n<<BigInt(2*n))-a-1n),a},M=t=>{const n=(t=>{const n=Math.ceil(t[0])+Math.ceil(t[1]);return 0===n?1:1+Math.floor(Math.log2(n))})(t),e=new Array(n),o=[i,i],s=r.vt();for(let i=0;i<n;i++){const u=r.Re(r.vt(),t,s),l=1<<n-1-i,c=r.hs(r.vt(),u,1/l),f=v(c,o);e[i]=f;const p=a(d(f,o)),h=r.hs(r.vt(),p,l);r.WQ(s,s,h),r.lw(o,o,g(f))}let u=0n;for(let r=0;r<n;r++){const t=1n<<BigInt(2*(n-1-r));u+=BigInt(e[r])*t}return u}},6562:(t,n,e)=>{e.r(n),e.d(n,{assets:()=>j,contentTitle:()=>S,default:()=>k,frontMatter:()=>y,metadata:()=>o,toc:()=>P});const o=JSON.parse('{"id":"populated-places","title":"Populated Places","description":"","source":"@site/src/examples/populated-places.mdx","sourceDirName":".","slug":"/populated-places","permalink":"/examples/populated-places","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"examplesSidebar","previous":{"title":"Airbnb","permalink":"/examples/airbnb"},"next":{"title":"Road Safety","permalink":"/examples/road-safety"}}');var r=e(4848),s=e(8453),i=e(6540),a=e(4258),u=(e(5338),e(9533)),l=e(3727),c=e(5890),f=e(6246),p=e(3537),d=e(1921);const g={longitude:-5,latitude:50,zoom:5};function h(t){let n=0,e=0;const o=[],r=t.features.map((t=>{const r=t.geometry.coordinates,s=t.properties?t.properties.pop_max:1e4;o.push({point:r,population:s});const i=(0,d.ce)(r,9);return Number(i>>58n)>42.5?e+=s:n+=s,{id:i,point:r,population:s}}));console.log("population in HD",100-.001*Math.round(1e5*e/(n+e)),"%");const s=r.filter(Boolean),i=new Map;for(const a of s){const{id:t}=a;i.has(t)?i.get(t).population+=a.population:i.set(t,a)}return{cells:[...i.values()],sourcePoints:o}}const w=()=>{const[t,n]=(0,i.useState)("column"),[e,o]=(0,i.useState)(null);(0,i.useEffect)((()=>{fetch("/data/ne_10m_populated_places_simple.geojson").then((t=>t.json())).then(h).then(o)}),[]);const s={data:e?.cells,getFillColor:t=>{const n=t.population/1e5;return[255*n,5*n,255-25*n,255]},extruded:!0,getElevation:t=>1e4+t.population/10,beforeId:"watername_ocean",parameters:{cullMode:"back"}},a=new c.A({...s,id:"cell-polygon",getPolygon:t=>(0,d.u$)(t.id),filled:!1,wireframe:!0,getLineColor:[255,255,255,255],visible:"polygon"===t}),l=new f.A({...s,id:"cell-column",getPosition:t=>(0,d.WH)(t.id),radius:2e3,radiusUnits:"meters",visible:"column"===t}),w=[!0,!1].map((n=>new p.A({id:"cell-point-"+(n?"visible":"hidden"),data:n?e?.sourcePoints:e?.cells,getPosition:n?t=>t.point:t=>(0,d.WH)(t.id),radiusUnits:"meters",radiusMaxPixels:n?10:20,lineWidthMaxPixels:2,filled:!0,stroked:!0,lineWidthUnits:"meters",getRadius:n?2e3:4e3,getLineWidth:500,getFillColor:n?[255,255,255,255]:t=>{const n=t.population/1e5;return[255*n,5*n,255-25*n,255]},getLineColor:[255,255,255,255],parameters:{depthCompare:"always",cullMode:"back"},getPolygonOffset:t=>[1,0],visible:"polygon"===t}))),m=t=>{let{layerType:n,setLayerType:e}=t;return(0,r.jsx)("div",{style:{position:"absolute",top:"20px",left:"20px",zIndex:1},children:(0,r.jsxs)("button",{onClick:()=>{e("polygon"===n?"column":"polygon")},style:{background:"white",border:"1px solid #ccc",borderRadius:"4px",padding:"8px 16px",cursor:"pointer",fontSize:"14px",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},children:["Show ","polygon"===n?"Column":"Cell"," View"]})})};return(0,r.jsxs)("div",{style:{position:"absolute",height:"100%",width:"100%",top:0,left:0,background:"linear-gradient(0, #000, #223)"},children:[(0,r.jsx)(u.T5,{id:"map",initialViewState:g,projection:"globe",mapStyle:"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",dragRotate:!1,maxPitch:0,children:(0,r.jsx)(v,{layers:[a,l,...w],interleaved:!0})}),(0,r.jsx)(m,{layerType:t,setLayerType:n})]})},m=w;function v(t){return(0,u.VI)((()=>new l.A(t))).setProps(t),null}var x=e(999);class M extends i.Component{static title="Populated Places";static code=(()=>`${a.l}/examples/website/populated-places`)();static parameters={};static renderInfo(t){return(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{children:"Populated places aggregated by A5, and drawn as 3D columns at cell centers."}),(0,r.jsx)("p",{children:"Switch to cell mode to see aggregation bounds, source points and cell centers."}),(0,r.jsxs)("p",{children:["Data: ",(0,r.jsx)("a",{href:"https://www.naturalearthdata.com/downloads/10m-cultural-vectors/",children:"Natural Earth"})]})]})}render(){return(0,r.jsx)("div",{style:{width:"100%",height:"100%",position:"absolute",background:"#111"},children:(0,r.jsx)(m,{...this.props})})}}const b=(0,x.xv)(M),y={},S="Populated Places",j={},P=[];function B(t){const n={h1:"h1",header:"header",...(0,s.R)(),...t.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"populated-places",children:"Populated Places"})}),"\n","\n",(0,r.jsx)(b,{})]})}function k(t={}){const{wrapper:n}={...(0,s.R)(),...t.components};return n?(0,r.jsx)(n,{...t,children:(0,r.jsx)(B,{...t})}):B(t)}},6864:(t,n,e)=>{e.d(n,{s:()=>w,r:()=>m});var o=e(7823),r=e(329),s=e(9699),i=e(1383),a=e(1148);function u(t){const n=t/a.UT;return(n-Math.round(n))*a.UT}function l(t){const n=t*a.ZP;return Math.tan(n)}const c=a.R,f=l(c)/c;function p(t){return function(t){return Math.atan(t)/a.ZP}(t*f)}function d(t,n){const e=t*(.95-.05*(Math.abs(n)/c));return Math.tan(e)}function g(t){let[n,e]=t;const o=u(e),r=function(t){return l(t)/f}(u(e)),s=r-o,i=Math.cos(o)/Math.cos(r)*n,c=a.mN/Math.cos(r),p=d(c,r)/c;return[d(i,r)/p,e+s]}function h(t){let[n,e]=t;const o=u(e),r=p(o),s=o-r,i=a.mN/Math.cos(o),l=function(t,n){const e=Math.abs(n)/c;return Math.atan(t)/(.95-.05*e)}(n*(d(i,o)/i),o);return[l/(Math.cos(r)/Math.cos(o)),e-s]}function w(t,n,e){const[o,s]=g(t),a=function(t){let[n,e]=t;return[e,Math.atan(n)]}([o,s+e]),u=(0,i.uB)(a);return r.gL(u,u,n),(0,i.lN)(u)}function m(t,n,e){const[o,a,u]=(0,i.uB)(t),l=s.vt();s.B8(l,n);const c=r.vt();r.gL(c,[o,a,u],l);const f=function(t){let[n,e]=t;return[Math.tan(e),n]}((0,i.lN)(c));return f[1]=f[1]-e,h(f)}o.fG(Float64Array)}}]);