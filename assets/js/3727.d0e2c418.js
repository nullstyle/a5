"use strict";(self.webpackChunkproject_website=self.webpackChunkproject_website||[]).push([[3727],{3727:(e,t,i)=>{i.d(t,{A:()=>U});var n=i(3908),s=i(1829),o=i(2130),r=i(2879),a=i(5775),l=i(6704),d=i(9451),c=i(6425),h=i(7964);const p=Math.PI/180,u=180/Math.PI,_=6370972,m=256;function g(){const e=4018225162502676e-20,t=Math.PI/180*m;return{unitsPerMeter:[e,e,e],unitsPerMeter2:[0,0,0],metersPerUnit:[24886.609375,24886.609375,24886.609375],unitsPerDegree:[t,t,e],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/t,1/t,24886.609375]}}class f extends a.A{constructor(e={}){const{longitude:t=0,zoom:i=0,nearZMultiplier:n=.5,farZMultiplier:s=1,resolution:o=10}=e;let{latitude:a=0,height:l,altitude:c=1.5,fovy:h}=e;a=Math.max(Math.min(a,d.aH),-d.aH),l=l||1,h?c=(0,d.wZ)(h):h=(0,d.Os)(c);const u=1/Math.PI/Math.cos(a*Math.PI/180),_=Math.pow(2,i)*u,m=e.nearZ??n,f=e.farZ??(c+512*_/l)*s,v=(new r.k).lookAt({eye:[0,-c,0],up:[0,0,1]});v.rotateX(a*p),v.rotateZ(-t*p),v.scale(_/l),super({...e,height:l,viewMatrix:v,longitude:t,latitude:a,zoom:i,distanceScales:g(),fovy:h,focalDistance:c,near:m,far:f}),this.scale=_,this.latitude=a,this.longitude=t,this.resolution=o}get projectionMode(){return l.Kx.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const t={targetZ:e.z||0},i=this.unproject([0,this.height/2],t),n=this.unproject([this.width/2,0],t),s=this.unproject([this.width,this.height/2],t),o=this.unproject([this.width/2,this.height],t);return s[0]<this.longitude&&(s[0]+=360),i[0]>this.longitude&&(i[0]-=360),[Math.min(i[0],s[0],n[0],o[0]),Math.min(i[1],s[1],n[1],o[1]),Math.max(i[0],s[0],n[0],o[0]),Math.max(i[1],s[1],n[1],o[1])]}unproject(e,{topLeft:t=!0,targetZ:i}={}){const[n,s,o]=e,r=t?s:this.height-s,{pixelUnprojectionMatrix:a}=this;let l;if(Number.isFinite(o))l=v(a,[n,r,o,1]);else{const e=v(a,[n,r,-1,1]),t=v(a,[n,r,1,1]),s=((i||0)/_+1)*m,o=c.uE(c.jb([],e,t)),d=c.uE(e),h=c.uE(t),p=4*((4*d*h-(o-d-h)**2)/16)/o,u=(Math.sqrt(d-p)-Math.sqrt(Math.max(0,s*s-p)))/Math.sqrt(o);l=c.Cc([],e,t,u)}const[d,h,p]=this.unprojectPosition(l);return Number.isFinite(o)?[d,h,p]:Number.isFinite(i)?[d,h,i]:[d,h]}projectPosition(e){const[t,i,n=0]=e,s=t*p,o=i*p,r=Math.cos(o),a=(n/_+1)*m;return[Math.sin(s)*r*a,-Math.cos(s)*r*a,Math.sin(o)*a]}unprojectPosition(e){const[t,i,n]=e,s=c.Il(e),o=Math.asin(n/s);return[Math.atan2(t,-i)*u,o*u,(s/m-1)*_]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){const i=this.unproject(t);return{longitude:e[0]-i[0]+this.longitude,latitude:e[1]-i[1]+this.latitude}}}function v(e,t){const i=h.Z0([],t,e);return h.hs(i,i,1/i[3]),i}var k=i(6992),w=i(4315),b=i(7483),y=i(2379),M=i(453),E=i(969);class x extends y.y{applyConstraints(e){const{maxZoom:t,minZoom:i,zoom:n}=e;e.zoom=(0,w.qE)(n,i,t);const{longitude:s,latitude:o}=e;return(s<-180||s>180)&&(e.longitude=(0,M.zi)(s+180,360)-180),e.latitude=(0,w.qE)(o,-d.aH,d.aH),e}}class P extends b.A{constructor(){super(...arguments),this.ControllerState=x,this.transition={transitionDuration:300,transitionInterpolator:new E.A(["longitude","latitude","zoom"])},this.dragMode="pan"}setProps(e){super.setProps(e),this.dragRotate=!1,this.touchRotate=!1}}class C extends o.A{constructor(e={}){super(e)}getViewportType(e){return e.zoom>12?k.A:f}get ControllerType(){return P}}C.displayName="GlobeView";const j=C;var z=i(3494),A=i(5801);const S=512,D=Math.PI/180;function I({map:e,gl:t,deck:i}){if(e.__deck)return e.__deck;const s=i?.props._customRender,o=i?.props.onLoad,r={...i?.props,_customRender:()=>{e.triggerRepaint(),s?.("")}};let a;return r.parameters={...F(e,!0),...r.parameters},r.views||(r.views=R(e)),i&&i.props.gl!==t||(Object.assign(r,{gl:t,width:null,height:null,touchAction:"unset",viewState:B(e)}),i?.isInitialized?O(i,e):r.onLoad=()=>{o?.(),O(a,e)}),i?(a=i,i.setProps(r),i.userData.isExternal=!0):(a=new n.A(r),e.on("remove",(()=>{Z(e)}))),a.userData.mapboxLayers=new Set,e.__deck=a,e.on("render",(()=>{a.isInitialized&&function(e,t){const{mapboxLayers:i,isExternal:n}=e.userData;if(n){const n=Array.from(i,(e=>e.id)),s=(0,A.B)(e.props.layers,Boolean).some((e=>e&&!n.includes(e.id)));let o=e.getViewports();const r=o.findIndex((e=>"mapbox"===e.id)),a=o.length>1||r<0;(s||a)&&(r>=0&&(o=o.slice(),o[r]=V(e,t)),e._drawLayers("mapbox-repaint",{viewports:o,layerFilter:t=>(!e.props.layerFilter||e.props.layerFilter(t))&&("mapbox"!==t.viewport.id||!n.includes(t.layer.id)),clearCanvas:!1}))}e.userData.currentViewport=null}(a,e)})),a}function O(e,t){const i=()=>{e.isInitialized?function(e,t){e.setProps({viewState:B(t)}),e.needsRedraw({clearRedrawFlags:!0})}(e,t):t.off("move",i)};t.on("move",i)}function Z(e){e.__deck?.finalize(),e.__deck=null}function F(e,t){const i=t?{depthWriteEnabled:!0,depthCompare:"less-equal",depthBias:0,blend:!0,blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",blendColorOperation:"add",blendAlphaOperation:"add"}:{};return"globe"===L(e)&&(i.cullMode="back"),i}function L(e){const t=e.getProjection?.(),i=t?.type||t?.name;if("globe"===i)return"globe";if(i&&"mercator"!==i)throw new Error("Unsupported projection");return"mercator"}function R(e){return"globe"===L(e)?new j({id:"mapbox"}):new z.A({id:"mapbox"})}function B(e){const{lng:t,lat:i}=e.getCenter(),n={longitude:(t+540)%360-180,latitude:i,zoom:e.getZoom(),bearing:e.getBearing(),pitch:e.getPitch(),padding:e.getPadding(),repeat:e.getRenderWorldCopies()};return e.getTerrain?.()&&function(e,t){if(e.getFreeCameraOptions){const{position:i}=e.getFreeCameraOptions();if(!i||void 0===i.z)return;const n=e.transform.height,{longitude:s,latitude:o,pitch:r}=t,a=i.x*S,l=(1-i.y)*S,c=i.z*S,h=(0,d.Gw)([s,o]),p=a-h[0],u=l-h[1],_=Math.sqrt(p*p+u*u),m=r*D,g=1.5*n,f=m<.001?g*Math.cos(m)/c:g*Math.sin(m)/_;t.zoom=Math.log2(f);const v=c-g*Math.cos(m)/f;t.position=[0,0,v/(0,d.mY)(o)]}else"number"==typeof e.transform.elevation&&(t.position=[0,0,e.transform.elevation])}(e,n),n}function V(e,t,i){const n=B(t),s=R(t);i&&(s.props.nearZMultiplier=.2);const o=i?.nearZ??t.transform._nearZ,r=i?.farZ??t.transform._farZ;return Number.isFinite(o)&&(n.nearZ=o/t.transform.height,n.farZ=r/t.transform.height),s.makeViewport({width:e.width,height:e.height,viewState:n})}function q(e){if(e.userData.isExternal)return;const t=[];e.userData.mapboxLayers.forEach((e=>{const i=new(0,e.props.type)(e.props);t.push(i)})),e.setProps({layers:t})}var N=i(8277);class X{constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.slot=e.slot,this.map=null,this.deck=null,this.props=e}onAdd(e,t){var i,n;this.map=e,this.deck=I({map:e,gl:t,deck:this.props.deck}),i=this.deck,n=this,i.userData.mapboxLayers.add(n),q(i)}onRemove(){var e,t;this.deck&&(e=this.deck,t=this,e.userData.mapboxLayers.delete(t),q(e))}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&q(this.deck)}render(e,t){!function(e,t,i,n){let{currentViewport:s}=e.userData,o=!1;s||(s=V(e,t,n),e.userData.currentViewport=s,o=!0),e.isInitialized&&e._drawLayers("mapbox-repaint",{viewports:[s],layerFilter:({layer:e})=>i.id===e.id||e.props.operation.includes("terrain"),clearStack:o,clearCanvas:!1})}(this.deck,this.map,this,t)}}const Y="__UNDEFINED__";function H(e,t,i,n){if(!(e&&t&&e.style&&e.style._loaded))return;const s=(0,A.B)(n,Boolean);if(i!==n){const t=(0,A.B)(i,Boolean),n=new Set(t.map((e=>e.id)));for(const e of s)n.delete(e.id);for(const i of n)e.getLayer(i)&&e.removeLayer(i)}for(const a of s){const i=e.getLayer(a.id);if(i){(i.implementation||i).setProps(a.props)}else e.addLayer(new X({id:a.id,deck:t,slot:a.props.slot}),a.props.beforeId)}const o=e.style._order,r={};for(const a of s){let{beforeId:e}=a.props;e&&o.includes(e)||(e=Y),r[e]=r[e]||[],r[e].push(a.id)}for(const a in r){const t=r[a];let i=a===Y?o.length:o.indexOf(a),n=a===Y?void 0:a;for(let s=t.length-1;s>=0;s--){const r=t[s],a=o.indexOf(r);a!==i-1&&(e.moveLayer(r,n),a>i&&i++),i--,n=r}}}class U{constructor(e){this._handleStyleChange=()=>{H(this._map,this._deck,this._props.layers,this._props.layers)},this._updateContainerSize=()=>{if(this._map&&this._container){const{clientWidth:e,clientHeight:t}=this._map.getContainer();Object.assign(this._container.style,{width:`${e}px`,height:`${t}px`})}},this._updateViewState=()=>{const e=this._deck,t=this._map;e&&t&&(e.setProps({views:this._props.views||R(t),viewState:B(t)}),e.isInitialized&&e.redraw())},this._handleMouseEvent=e=>{const t=this._deck;if(!t||!t.isInitialized)return;const i={type:e.type,offsetCenter:e.point,srcEvent:e},n=this._lastMouseDownPoint;switch(!e.point&&n&&(i.deltaX=e.originalEvent.clientX-n.clientX,i.deltaY=e.originalEvent.clientY-n.clientY,i.offsetCenter={x:n.x+i.deltaX,y:n.y+i.deltaY}),i.type){case"mousedown":t._onPointerDown(i),this._lastMouseDownPoint={...e.point,clientX:e.originalEvent.clientX,clientY:e.originalEvent.clientY};break;case"dragstart":i.type="panstart",t._onEvent(i);break;case"drag":i.type="panmove",t._onEvent(i);break;case"dragend":i.type="panend",t._onEvent(i);break;case"click":i.tapCount=1,t._onEvent(i);break;case"dblclick":i.type="click",i.tapCount=2,t._onEvent(i);break;case"mousemove":i.type="pointermove",t._onPointerMove(i);break;case"mouseout":i.type="pointerleave",t._onPointerMove(i);break;default:return}};const{interleaved:t=!1,...i}=e;this._interleaved=t,this._props=i}setProps(e){this._interleaved&&e.layers&&H(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,e),this._deck&&this._map&&this._deck.setProps({...this._props,parameters:{...F(this._map,this._interleaved),...this._props.parameters}})}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){const t=document.createElement("div");return Object.assign(t.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=t,this._deck=new n.A({...this._props,parent:t,parameters:{...F(e,!1),...this._props.parameters},views:this._props.views||R(e),viewState:B(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),t}_onAddInterleaved(e){const t=e.painter.context.gl;return t instanceof WebGLRenderingContext&&N.A.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=I({map:e,gl:t,deck:new n.A({...this._props,gl:t})}),e.on("styledata",this._handleStyleChange),H(e,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){const e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),this._deck?.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),H(e,this._deck,this._props.layers,[]),Z(e)}getDefaultPosition(){return"top-left"}pickObject(e){return(0,s.A)(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return(0,s.A)(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return(0,s.A)(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}}}}]);